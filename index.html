 <!DOCTYPE html>
<html>
  <head>
    <style>
      h1 {text-align: center;}  
      p {text-align: center;}
      div {text-align: center;}
    </style>
  </head>
  
<body>

<h1>Server Side Template Injection</h1>
<p>
כמה זה 7*7? 49?
לא יודע איפה למדתם מתמטיקה, אבל זה ממש לא 49, בואו נתווכח על זה.

בשביל להבין מדוע 7*7 לא שווה ל49, אתם צריכים להבין מה הרעיון מאחוריי template.

אז מהם templates?

templates הם פשוט "תבניות" שמכילות.. תוכן.
אם יש שרת web, שרובו הוא אותו דבר אך יש חלק ממש קטן שמשתנה מבקשה לבקשה, אז יש סיכוי טוב שהוא משתמש בtemplates.
בואו ניקח עמוד פרופיל של אחד המשתמשים שמציג רק את שם המשתמש, לדוגמא:

User: John Doh

וברגע שנרצה לראות פרופיל של משתמש אחר, רק שם המשתמש המוצג בדף משתנה. (החלק הצבוע בסגול):

User: John Doh
User: James Brown
User: Roni King

templates מוצגים כך:
User: {user.name}

ניתן לחלק templates לשני חלקים - סטטי ודינמי.
באדום - החלק הסטטי (קבוע)
בסגול - החלק הדינמי (משתנה)
החלק הדינמי תמיד יהיה הערך היחידי שמשתנה ובתוך סוגריים מסולסלות.

נקודה חשובה היא שלא כל הtemplates מוצגים כך:
User: { user.name }

אלא יכולים להיות מוצגים עם דאבל סוגריים מסולסלות:
User: {{ user.name }}

זו רק דוגמא למנוע templates שנקרא Jinja
שעובד במסגרת פייתון.

יש לא מעט סוגי מנועים לtemplates , והסינטקס שאיתו הדף מציג את המידע יכול להשתנות ממנוע למנוע.
אבל הרעיון של templates נשאר זהה לכולם.

Vulnerability
Template injection

כמו שהשם מרמז, מדובר בפגיעות שמנצלים בעזרת הזרקה, כאשר קלט המשתמש משתלב עם ההגדרה של הtemplate.
לדוגמא:

template = "Bio:" {{ user.bio }}

בדוגמא הזו המידע מוצג כאשר המידע נמשך מהtemplate וזה בטוח לחלוטין,
שכל מה שהוא עושה זה למשוך את המידע, להחזיר ולהציג אותו למשתמש.

אבל בואו ניקח דוגמא נוספת:

template = "Bio:" + USER_INPUT

אם קלט המשתמש הופך לחלק בתוך ההגדרה של הtemplate, צריכה להידלק נורה אדומה.
מהסיבה שלtemplate (או המנוע שעובד מאחורי הקלעים) יש אפשרות לבצע חישובים,הרצת פקודות ועוד, ולכן למשתמש יש אפשרות לבצע אופרציה פשוטה לווידוי הפגיעות כמו:

Bio:": {{ 7*7 }}"

וכתוצאה נקבל:

Bio:": 49"

או אפילו להריץ פקודות על העמדה הפגועה מרחוק:

Bio:": {{ exec('ls') }}"

נקודה חשובה נוספת היא שהפגיעות היא לא רק בצד שרת אלא בכל הצדדים שאתם מכירים, כל עוד יש שימוש בtemplates.
מדובר בנושא ענק, שבאשכול אחד לא ניתן לסגור את כל הפינות, אך זה הבסיס לפגיעות.

ותזכרו, אף פעם אל תסמכו על קוד בשילוב של קלט מהמשתמש, תתייחסו לקלט כלא בטוח, תמיד.

ולבסוף, 7*7 , זה מה? נכון, זה Server Side Template Injections

נשתמע :)</p>

</body>
</html> 
